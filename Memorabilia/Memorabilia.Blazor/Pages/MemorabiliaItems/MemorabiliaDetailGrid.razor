<MudTable @ref="_table" 
          Bordered="false"
          Dense="false" 
          Hover="true"
          Items="Model.MemorabiliaItems" 
          ServerData="@(new Func<TableState, Task<TableData<MemorabiliaModel>>>(OnRead))"
          Striped="true">
    <NoRecordsContent>
        <NoRecords Text="No Memorabilia Found" />
    </NoRecordsContent>
    <ToolBarContent>
        <Stack Style="@($"{Style.MarginLeftPad1}{Style.MarginTopPad1}")">
            <ToolbarTitle Text="My Memorabilia" />
            <RowStack Visible="CanSelect">
                <CustomButton ButtonType="ButtonType.Button"
                              OnClick="OnSelectAll"
                              Text="@SelectAllButtonText" />
            </RowStack>
        </Stack>
    </ToolBarContent>
    <HeaderContent>
        <TableHeader Visible="CanSelect" />
        <MudTh></MudTh>
        <MudTh>Item</MudTh>
        <MudTh>Condition</MudTh>
        <MudTh>Value</MudTh>
        <MudTh>Acquisition Type</MudTh>
        <MudTh>Acquisition Date</MudTh>
        <MudTh>Cost</MudTh>
        <MudTh>Purchase Place</MudTh>
        <MudTh></MudTh>
    </HeaderContent>
    <RowTemplate>
        <TableData Visible="CanSelect">
            <BooleanCheckBox Checked="@(SelectedMemorabilia.Contains(context))"
                             CheckedChanged="(p) => OnMemorabiliaSelected(context)" />
        </TableData>
        <MudTd>
            <ToggleGridButton Toggled="@(_ => ToggleChildContent(context.Id))"
                              Visible="@(context.AutographsCount > 0)" />
        </MudTd>
        <MudTd DataLabel="">
            <GridImage AllowNavigation="true"
                       ImageFileName="@context.ImageFileName"
                       ImageLoaded="StateHasChanged"
                       NavigationPath="@($"{NavigationPath.MemorabiliaImage}/{Constant.EditModeType.Update.Name}/{DataProtectorService.EncryptId(context.Id)}")"
                       TooltipText="@context.ImageDisplayCount" />
        </MudTd>
        <MudTd DataLabel="Item">@context.ItemTypeName</MudTd>
        <MudTd DataLabel="Condition">@context.ConditionName</MudTd>
        <MudTd DataLabel="Value">@context.EstimatedValue?.ToString("c")</MudTd>
        <MudTd DataLabel="Acquisition Type">@context.AcquisitionTypeName</MudTd>
        <MudTd DataLabel="Acquisition Date">@context.Acquisition.AcquiredDate?.ToString("MM-dd-yyyy")</MudTd>
        <MudTd DataLabel="Cost">@context.Acquisition.Cost?.ToString("c")</MudTd>
        <MudTd DataLabel="Purchase Place">@context.PurchaseTypeName</MudTd>
        <TableDataRightAligned Visible="ShowActions">
            <ViewMemorabiliaImagesFab MemorabiliaId="context.Id"
                                      Size="MudBlazor.Size.Small"
                                      Visible="@context.Images.Any()" />
            <Fab Color="MudBlazor.Color.Primary"
                 OnClick="@(_ => NavigationManager.NavigateTo($"{NavigationPath.Autographs}/{Constant.EditModeType.Update.Name}/{DataProtectorService.EncryptId(context.Id)}/0"))"
                 Size="MudBlazor.Size.Small"
                 StartIcon="@Icons.Material.Outlined.AddCircleOutline"
                 TooltipText="Add Autograph" />
            <Fab Color="MudBlazor.Color.Info"
                 OnClick="@(_ => NavigationManager.NavigateTo($"{NavigationPath.Memorabilia}/{context.ItemTypeName.Replace(" ", "")}/Edit/{DataProtectorService.EncryptId(context.Id)}"))"
                 Size="MudBlazor.Size.Small"
                 StartIcon="@Icons.Material.Outlined.Info"
                 TooltipText="Details" />
            <EditGridButton OnEdit="@(_ => NavigationManager.NavigateTo($"{NavigationPath.Memorabilia}/{Constant.EditModeType.Update.Name}/{DataProtectorService.EncryptId(context.Id)}"))"
                            Size="MudBlazor.Size.Small" />
            <DeleteGridButton ConfirmMessage="Delete Memorabilia"
                              OnDelete="@(_ => DeleteMemorabiliaItem(context.Id))"
                              ShowConfirm="true"
                              Size="MudBlazor.Size.Small" />
        </TableDataRightAligned>
    </RowTemplate>
    <ChildRowContent>
        <HiddenControl Visible="context.DisplayAutographDetails">
            <tr />
            <SummarySection>
                <TableDataCentered>
                    Summary: Autographs - <strong> @context.AutographsCount </strong>, Total Value - <strong> @context.FormattedTotalValue </strong>, Total Cost - <strong> @context.FormattedTotalCost </strong>
                </TableDataCentered>
            </SummarySection>
            <tr />
            <TableRowPadded>
                <TableDataSpan>
                    <MudTable Bordered="false"
                              Dense="false"
                              Hover="true"
                              Items="context.Autographs"
                              Striped="true">
                        <ToolBarContent>
                            <ToolbarTitle Text="Autographs" />
                            <MudSpacer />
                        </ToolBarContent>
                        <HeaderContent>
                            <MudTh></MudTh>
                            <MudTh>Person</MudTh>
                            <MudTh>Condition</MudTh>
                            <MudTh>Value</MudTh>
                            <MudTh>Acquisition Type</MudTh>
                            <MudTh>Acquired Date</MudTh>
                            <MudTh>Cost</MudTh>
                            <MudTh>Purchase Place</MudTh>
                            <MudTh>Writing Instrument</MudTh>
                            <MudTh>Color</MudTh>
                            <MudTh>Authentications</MudTh>
                            <MudTh>Inscriptions</MudTh>
                            <TableHeader Visible="ShowActions"></TableHeader>
                        </HeaderContent>
                        <RowTemplate Context="autograph">
                            <MudTd DataLabel="Name">
                                <PersonGridImage ImageData="@(ImageService.GetPersonImageData(autograph.PersonImageName))"
                                                 ImageLoaded="StateHasChanged"
                                                 PersonId="autograph.Person.Id" />
                            </MudTd>
                            <MudTd DataLabel="Abbreviation">@autograph.PersonName</MudTd>
                            <MudTd DataLabel="Condition">@autograph.ConditionName</MudTd>
                            <MudTd DataLabel="Value">@autograph.FormattedEstimatedValue</MudTd>
                            <MudTd DataLabel="Acquisition Type">@autograph.AcquisitionTypeName</MudTd>
                            <MudTd DataLabel="Acquired Date">@autograph.FormattedAcquisitionDate</MudTd>
                            <MudTd DataLabel="Cost">@autograph.FormattedCost</MudTd>
                            <MudTd DataLabel="Purchase Place">@autograph.PurchaseTypeName</MudTd>
                            <MudTd DataLabel="Writing Instrument">@autograph.WritingInstrumentName</MudTd>
                            <MudTd DataLabel="Color">@autograph.ColorName</MudTd>
                            <MudTd DataLabel="Authentications"
                                   Style="text-align:center">
                                <Chip Color="MudBlazor.Color.Info"
                                      OnClick="@(_ => NavigationManager.NavigateTo($"{NavigationPath.Authentications}/{Constant.EditModeType.Update.Name}/{DataProtectorService.EncryptId(autograph.Id)}"))"
                                      Size="MudBlazor.Size.Small"
                                      Text="@autograph.AuthenticationText"
                                      TooltipText="@autograph.AuthenticationTooltip" />
                            </MudTd>
                            <MudTd DataLabel="Inscriptions"
                                   Style="text-align:center">
                                <Chip Color="MudBlazor.Color.Info"
                                      OnClick="@(_ => NavigationManager.NavigateTo($"{NavigationPath.Inscriptions}/{Constant.EditModeType.Update.Name}/{DataProtectorService.EncryptId(autograph.Id)}"))"
                                      Size="MudBlazor.Size.Small"
                                      Text="@autograph.InscriptionText"
                                      TooltipText="@autograph.InscriptionTooltip" />
                            </MudTd>
                            <TableDataRightAligned Visible="ShowActions">
                                <ViewAutographImagesFab AutographId="autograph.Id"
                                                        Size="MudBlazor.Size.Small"
                                                        Visible="@context.Images.Any()" />
                                <EditGridButton OnEdit="@(_ => NavigationManager.NavigateTo($"{NavigationPath.Autographs}/{Constant.EditModeType.Update.Name}/{DataProtectorService.EncryptId(autograph.MemorabiliaId)}/{DataProtectorService.EncryptId(autograph.Id)}"))"
                                                Size="MudBlazor.Size.Small" />
                                <DeleteGridButton ConfirmMessage="Delete Autograph"
                                                  OnDelete="@(_ => DeleteAutograph(context.Id))"
                                                  ShowConfirm="true"
                                                  Size="MudBlazor.Size.Small" />
                            </TableDataRightAligned>
                        </RowTemplate>
                        <PagerContent>
                            <MudTablePager />
                        </PagerContent>
                    </MudTable>
                </TableDataSpan>
            </TableRowPadded>
        </HiddenControl>
    </ChildRowContent>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>
