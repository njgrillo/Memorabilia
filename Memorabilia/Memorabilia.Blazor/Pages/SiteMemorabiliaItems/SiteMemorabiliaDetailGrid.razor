@inherits ReroutePage

<MudTable @ref="_table"
          Bordered="false"
          Dense="false"
          Hover="true"
          Items="@Model.MemorabiliaItems"
          ServerData="@(new Func<TableState, Task<TableData<SiteMemorabiliaModel>>>(OnRead))"
          Striped="true">
    <ToolBarContent>
        <ToolbarTitle Text="All Memorabilia" />
    </ToolBarContent>
    <HeaderContent>
        <TableHeader Visible="CanSelect">
            <CustomButton ButtonType="ButtonType.Button"
                          OnClick="OnSelectAll"
                          Text="@SelectAllButtonText" />
        </TableHeader>
        <MudTh></MudTh>
        <MudTh></MudTh>
        <MudTh>Item</MudTh>
        <MudTh>Condition</MudTh>
        <MudTh>Buy Now Price</MudTh>
        <MudTh></MudTh>
    </HeaderContent>
    <RowTemplate>
        <TableData DataLabel=""
                   Visible="CanSelect">
            <BooleanCheckBox Checked="@(SelectedMemorabilia.Contains(context))"
                             CheckedChanged="(p) => OnMemorabiliaSelected(context)" />
        </TableData>
        <MudTd>
            <MudIconButton Icon="@context.ToggleIcon"
                           OnClick="@(_ => ToggleChildContent(context.Id))" />
        </MudTd>
        <MudTd DataLabel="">
            <GridImage ImageLoaded="@(_ => StateHasChanged())"
                       ImageFileName="@context.ImageFileName"
                       UserId="@context.UserId" />
        </MudTd>
        <MudTd DataLabel="Item">@context.ItemTypeName</MudTd>
        <MudTd DataLabel="Condition">@context.ConditionName</MudTd>
        <MudTd DataLabel="BuyNowPrice">
            @(context.IsForSale && context.BuyNowPrice.HasValue ? context.BuyNowPrice.Value.ToString("c") : "Not for sale")
        </MudTd>
        <TableData DataLabel=""
                   Visible="ShowActions">
            <ViewMemorabiliaImagesFab MemorabiliaId="context.Memorabilia.Id"
                                      Size="@MudBlazor.Size.Large"
                                      UserId="context.UserId" />
            <Fab Color="MudBlazor.Color.Primary"                 
                 OnClick="@(_ => OnProposeTrade(context.Memorabilia.Id))"
                 StartIcon="@Icons.Material.Outlined.SwapHoriz"
                 TooltipText="Propose Trade"
                 Visible="@context.ForTrade" />
            <Fab Color="MudBlazor.Color.Primary"                 
                 OnClick="OnBuyNow"
                 StartIcon="@Icons.Material.Outlined.AttachMoney"
                 TooltipText="Buy Now"
                 Visible="@(context.IsForSale && context.BuyNowPrice.HasValue)" />
            <Fab Color="MudBlazor.Color.Primary"                 
                 OnClick="@(_ => OnMakeOffer(context.Memorabilia.Id))"
                 StartIcon="@Icons.Material.Outlined.LocalOffer"
                 TooltipText="Make Offer"
                 Visible="@(context.IsForSale && context.AllowBestOffer)" />
        </TableData>
    </RowTemplate>
    <ChildRowContent>
        <Condition Evaluation="@context.DisplayAutographDetails">
            <Match>
                <tr />
                <tr style="background-color:#6D7B8D;color:honeydew;border-style:dashed;border-width:2px;border-color:#ECF3F4;">
                    <td align="center" colspan="17">
                        Summary: Autographs - <strong> @context.AutographsCount </strong>
                    </td>
                    <Condition Evaluation="@(!context.Note.IsNullOrEmpty())">
                        <Match>
                            <br />
                            <td align="center" colspan="17">
                                Notes:<strong> @context.Note </strong>
                            </td>
                        </Match>
                    </Condition>
                </tr>
                <tr />
                <tr style="margin-top: 1%; margin-bottom: 1%; margin-left: 1%; margin-right: 1%;">
                    <td colspan="17">
                        <MudTable Bordered="false"
                                  Dense="false"
                                  Hover="true"
                                  Items="@context.Autographs"
                                  Striped="true">
                            <ToolBarContent>
                                <ToolbarTitle Text="Autographs" />
                                <MudSpacer />
                            </ToolBarContent>
                            <HeaderContent>
                                <MudTh></MudTh>
                                <MudTh>Person</MudTh>
                                <MudTh>Condition</MudTh>
                                <MudTh>Writing Instrument</MudTh>
                                <MudTh>Color</MudTh>
                                <MudTh>Authentications</MudTh>
                                <MudTh>Inscriptions</MudTh>
                                <MudTh></MudTh>
                            </HeaderContent>
                            <RowTemplate Context="autograph">
                                <MudTd DataLabel="">
                                    <GridImage ImageData="@(ImageService.GetPersonImageData(autograph.PersonImageName))"
                                               ImageLoaded="@(_ => StateHasChanged())" />
                                </MudTd>
                                <MudTd DataLabel="Person">@autograph.PersonName</MudTd>
                                <MudTd DataLabel="Condition">@autograph.ConditionName</MudTd>
                                <MudTd DataLabel="Writing Instrument">@autograph.WritingInstrumentName</MudTd>
                                <MudTd DataLabel="Color">@autograph.ColorName</MudTd>
                                <MudTd DataLabel="Authentications"
                                       Style="text-align:center">
                                    <Chip Color="MudBlazor.Color.Info"
                                          Size="@MudBlazor.Size.Small"
                                          Text="@autograph.AuthenticationText"
                                          TooltipText="@autograph.AuthenticationTooltip" />
                                </MudTd>
                                <MudTd DataLabel="Inscriptions"
                                       Style="text-align:center">
                                    <Chip Color="MudBlazor.Color.Info"
                                          Size="@MudBlazor.Size.Small"
                                          Text="@autograph.InscriptionText"
                                          TooltipText="@autograph.InscriptionTooltip" />
                                </MudTd>
                                <MudTd>
                                    <ViewAutographImagesFab AutographId="autograph.Id" />
                                </MudTd>
                            </RowTemplate>
                            <PagerContent>
                                <MudTablePager />
                            </PagerContent>
                        </MudTable>
                    </td>                    
                </tr>
            </Match>
        </Condition>
    </ChildRowContent>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>
