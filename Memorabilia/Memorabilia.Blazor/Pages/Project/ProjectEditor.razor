@inherits ImagePage

<EditPage ContinueNavigationPath="@_viewModel.ContinueNavigationPath"
          DomainImageRootPath="@DomainImageRootPath"
          EditMode="_viewModel.EditModeType" 
          ExitNavigationPath="@_viewModel.ExitNavigationPath"
          ImageFileName="@_viewModel.ImageFileName" 
          ImageRootPath="@ImageRootPath"
          ItemName="@_viewModel.PageTitle"
          Model="_viewModel"
          OnLoad="OnLoad"
          OnSave="HandleValidSubmit"
          PageFooterButtonText="@_viewModel.ExitButtonText"
          PageFooterNavigationPath="@_viewModel.ExitNavigationPath"
          PageTitle="@_viewModel.PageTitle"
          TItem="SaveProjectViewModel">
    <Content>
        <DivRowCol3>
            <Content>
                <TextField Label="Name"
                           SelectedText="@_viewModel.Name"
                           SelectedTextChanged="@((p) => _viewModel.Name = p)"/>
            </Content>
            <ContentColumn2>
                <ItemTypeDropDown Label="Default Item Type"
                                  SelectedValue="_viewModel.ItemTypeId"
                                  SelectionChanged="(p) => _viewModel.ItemTypeId = p" />
            </ContentColumn2>
        </DivRowCol3>
        <DivRowCol3>
            <Content>
                <MudDatePicker @bind-Date="_viewModel.StartDate"
                               Label="Start Date"
                               Variant="Variant.Outlined" />
            </Content>
            <ContentColumn2>
                <MudDatePicker @bind-Date="_viewModel.EndDate"
                               Label="End Date"
                               Variant="Variant.Outlined" />
            </ContentColumn2>
        </DivRowCol3>
        <br />
        <DivRowCol3>
            <Content>
                <MudText Typo="Typo.h3">Project People</MudText>
            </Content>
        </DivRowCol3>   
        <DivLeftAlign>
            <Content>
                <PersonSelector Disabled="@(!_canEditPerson)"
                                SelectedPerson="_projectPersonViewModel.Person"
                                SelectedPersonChanged="(p) => _projectPersonViewModel.Person = p" /> 
            </Content>
        </DivLeftAlign>
        <DivRowCol3>
            <Content>
                <ItemTypeDropDown Disabled="_viewModel.HasDefaultItemType" 
                                  Label="Item Type"
                                  SelectedValue="_projectPersonViewModel.ItemTypeId"
                                  SelectionChanged="(p) => _projectPersonViewModel.ItemTypeId = p" />
            </Content>
            <ContentColumn2>
                <ProjectStatusTypeDropDown SelectedValue="_projectPersonViewModel.ProjectStatusTypeId"
                                           SelectionChanged="(p) => _projectPersonViewModel.ProjectStatusTypeId = p" />
            </ContentColumn2>
        </DivRowCol3>
        <DivRowCol3>
            <Content>
                <PriorityTypeDropDown SelectedValue="_projectPersonViewModel.PriorityTypeId"
                                      SelectionChanged="(p) => _projectPersonViewModel.PriorityTypeId = p" />
            </Content>
            <ContentColumn2>
                <NullableIntField Label="Rank"
                                  Value="_projectPersonViewModel.Rank"
                                  ValueChanged="@((p) => _projectPersonViewModel.Rank = p)" />
            </ContentColumn2>
        </DivRowCol3>
        <DivRowCol3>
            <Content>
                <BooleanCheckBox Checked="@_projectPersonViewModel.Upgrade"
                                 CheckedChanged="(p) => _projectPersonViewModel.Upgrade = p"  
                                 Label="Is Upgrade" /> 
            </Content>
        </DivRowCol3>
        <DivLeftAlign>
            <Content>
                <DivHidden Hidden="@(!_canAddProjectPerson)">
                    <Content>
                        <AddButton OnClick="AddProjectPerson" />
                    </Content>
                </DivHidden>
                <DivHidden Hidden="@(!_canUpdateProjectPerson)">
                    <Content>
                        <UpdateButton OnClick="UpdateProjectPerson" />
                    </Content>
                </DivHidden>
            </Content>
        </DivLeftAlign> 
        <DivRowCol12>
            <Content>
                <MudTable Bordered="false"
                          CommitEditTooltip="Save"
                          Dense="false" 
                          Filter="new Func<SaveProjectPersonViewModel,bool>(FilterFunc1)"
                          Hover="true"
                          Items="@_viewModel.People.Where(person => !person.IsDeleted).OrderBy(person => person.Rank)"  
                          Striped="true">
                    <ToolBarContent>
                        <MudText Typo="Typo.h6">Project Details</MudText>
                        <MudSpacer />
                        <MudTextField @bind-Value="_search"
                                      Adornment="Adornment.Start"
                                      AdornmentIcon="@Icons.Material.Filled.Search"
                                      Class="mt-0"
                                      IconSize="MudBlazor.Size.Medium"
                                      Placeholder="Search" />                        
                    </ToolBarContent>
                    <HeaderContent>
                        <MudTh></MudTh>
                        <MudTh>Rank</MudTh>
                        <MudTh></MudTh>
                        <MudTh>Person</MudTh>
                        <MudTh>Item</MudTh>                        
                        <MudTh>Priority</MudTh>
                        <MudTh>Upgrade</MudTh>
                        <MudTh>Deceased</MudTh>
                        <MudTh></MudTh>
                    </HeaderContent>
                    <RowTemplate Context="projectPerson">
                        <MudTd>
                           <MudIconButton @onclick="@(_ => MoveToTop(projectPerson.Rank ?? 0))"
                                          hidden="@(!projectPerson.DisplayDoubleUpIcon)"
                                          Icon="@projectPerson.DoubleUpIcon"></MudIconButton>
                           <MudIconButton @onclick="@(_ => MoveUp(projectPerson.Rank ?? 0))"
                                          hidden="@(!projectPerson.DisplayUpIcon)"
                                          Icon="@projectPerson.UpIcon"></MudIconButton>
                           <MudIconButton @onclick="@(_ => MoveDown(projectPerson.Rank ?? 0))"
                                          Icon="@projectPerson.DownIcon"></MudIconButton>
                           <MudIconButton @onclick="@(_ => MoveToBottom(projectPerson.Rank ?? 0))"
                                          Icon="@projectPerson.DoubleDownIcon"></MudIconButton>
                        </MudTd>
                        <MudTd DataLabel="Rank">@projectPerson.Rank</MudTd>
                        <MudTd DataLabel="">
                            <MudImage Class="rounded-lg can-click" 
                                      Elevation="5" 
                                      Height="200"
                                      ObjectFit="@ObjectFit.Cover"
                                      Src="@(GetImageData(projectPerson.Person.PersonImageFileName))"
                                      Width="200" />
                        </MudTd>
                        <MudTd DataLabel="Person">@projectPerson.Person.DisplayName</MudTd>
                        <MudTd DataLabel="Item">@projectPerson.ItemTypeName</MudTd>                        
                        <MudTd DataLabel="Priority">@projectPerson.PriorityTypeName</MudTd>
                        <MudTd DataLabel="Upgrade">@(projectPerson.Upgrade ? "Yes" : "No")</MudTd>
                        <MudTd DataLabel="Deceased">@(projectPerson.Deceased ? "Yes" : "No")</MudTd>
                        <MudTd DataLabel="Status">@projectPerson.ProjectStatusTypeName</MudTd>
                        <MudTd DataLabel="">
                            <MudTooltip Text="Edit">
                                <MudFab Color="MudBlazor.Color.Primary"                                
                                        Icon="@Icons.Outlined.ModeEditOutline"
                                        OnClick="@(_ => Edit(projectPerson))" />
                            </MudTooltip>   
                            <MudTooltip Text="Delete">
                                <MudFab Color="MudBlazor.Color.Secondary"
                                        Icon="@Icons.Outlined.DeleteOutline"
                                        OnClick="@(_ => Remove(projectPerson.Id, projectPerson.Person.Id, projectPerson.ItemTypeId))" />
                            </MudTooltip>
                        </MudTd>
                    </RowTemplate>
                </MudTable>
            </Content>
        </DivRowCol12>
        <br />
    </Content>
</EditPage>
