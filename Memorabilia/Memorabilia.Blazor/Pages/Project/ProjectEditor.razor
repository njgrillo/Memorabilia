@inherits ImagePage

<EditPage ContinueNavigationPath="@_viewModel.ContinueNavigationPath"
          DomainImageRootPath="@DomainImageRootPath"
          EditMode="_viewModel.EditModeType" 
          ExitNavigationPath="@_viewModel.ExitNavigationPath"
          ImageFileName="@_viewModel.ImageFileName" 
          ImageRootPath="@ImageRootPath"
          ItemName="@_viewModel.PageTitle"
          Model="_viewModel"
          OnLoad="OnLoad"
          OnSave="HandleValidSubmit"
          PageFooterButtonText="@_viewModel.ExitButtonText"
          PageFooterNavigationPath="@_viewModel.ExitNavigationPath"
          PageTitle="@_viewModel.PageTitle"
          TItem="SaveProjectViewModel">
    <Content>
        <DivRowCol3>
            <Content>
                <TextField Label="Name"
                           SelectedText="@_viewModel.Name"
                           SelectedTextChanged="@((p) => _viewModel.Name = p)"/>
            </Content>
            <ContentColumn2>
                <ItemTypeDropDown Disabled="@(_viewModel.Id > 0)" 
                                  Label="Default Item Type"
                                  SelectedValue="_viewModel.ItemTypeId"
                                  SelectionChanged="(p) => _viewModel.ItemTypeId = p" />
            </ContentColumn2>
            <ContentColumn3>
                <MudDatePicker @bind-Date="_viewModel.StartDate"
                               Label="Start Date"
                               Variant="Variant.Outlined" />
            </ContentColumn3>
            <ContentColumn4>
                <MudDatePicker @bind-Date="_viewModel.EndDate"
                               Label="End Date"
                               Variant="Variant.Outlined" />
            </ContentColumn4>
        </DivRowCol3>
        <br />
        <DivLeftAlign>
            <Content>
                <DivHidden Hidden="@(_viewModel.ItemTypeId == 0)">
                    <Content>
                        <AddButton OnClick="AddProjectPerson" 
                                   Text="Add Project Person"/>
                    </Content>
                </DivHidden>
            </Content>
        </DivLeftAlign> 
        <br />
        <DivRowCol12>
            <Content>
                    <MudTable Bordered="false"
                              CanCancelEdit="true"
                              CommitEditTooltip="Save"
                              Dense="false"
                              Filter="new Func<SaveProjectPersonViewModel,bool>(FilterFunc1)"
                              Hover="true"
                              Items="@_viewModel.People.Where(person => !person.IsDeleted).OrderBy(person => person.Rank)"
                              RowEditCancel="ResetItemToOriginalValues"
                              RowEditCommit="UpdateRanks"
                              RowEditPreview="BackupItem"
                              Striped="true">
                        <ToolBarContent>
                            <MudText Typo="Typo.h6">Project People</MudText>
                            <MudSpacer />
                            <MudTextField @bind-Value="_search"
                                          Adornment="Adornment.Start"
                                          AdornmentIcon="@Icons.Material.Filled.Search"
                                          Class="mt-0"
                                          IconSize="MudBlazor.Size.Medium"
                                          Placeholder="Search" />
                        </ToolBarContent>
                        <HeaderContent>
                            <MudTh></MudTh>
                            <MudTh>
                                <MudTableSortLabel SortBy="new Func<SaveProjectPersonViewModel, object>(x=>x.Rank)">
                                    Rank
                                </MudTableSortLabel>
                            </MudTh>
                            <MudTh></MudTh>
                            <MudTh>
                                <MudTableSortLabel SortBy="new Func<SaveProjectPersonViewModel, object>(x=>x.Person.DisplayName)">
                                    Person
                                </MudTableSortLabel>
                            </MudTh>
                            <MudTh>Item</MudTh>
                            <MudTh>
                                <MudTableSortLabel SortBy="new Func<SaveProjectPersonViewModel, object>(x=>x.PriorityTypeName)">
                                    Priority
                                </MudTableSortLabel>
                            </MudTh>
                            <MudTh>
                                <MudTableSortLabel SortBy="new Func<SaveProjectPersonViewModel, object>(x=>x.Upgrade)">
                                    Upgrade
                                </MudTableSortLabel>
                            </MudTh>
                            <MudTh>
                                <MudTableSortLabel SortBy="new Func<SaveProjectPersonViewModel, object>(x=>x.Deceased)">
                                    Deceased
                                </MudTableSortLabel>
                            </MudTh>
                            <MudTh>
                                <MudTableSortLabel SortBy="new Func<SaveProjectPersonViewModel, object>(x=>x.ProjectStatusTypeName)">
                                    Status
                                </MudTableSortLabel>
                            </MudTh>
                            <MudTh></MudTh>
                        </HeaderContent>
                        <RowTemplate Context="projectPerson">
                            <MudTd>
                                <MudIconButton @onclick="@(_ => MoveToTop(projectPerson.Rank ?? 0))"
                                               hidden="@(!projectPerson.DisplayDoubleUpIcon)"
                                               Icon="@projectPerson.DoubleUpIcon"></MudIconButton>
                                <MudIconButton @onclick="@(_ => MoveUp(projectPerson.Rank ?? 0))"
                                               hidden="@(!projectPerson.DisplayUpIcon)"
                                               Icon="@projectPerson.UpIcon"></MudIconButton>
                                <MudIconButton @onclick="@(_ => MoveDown(projectPerson.Rank ?? 0))"
                                               Icon="@projectPerson.DownIcon"></MudIconButton>
                                <MudIconButton @onclick="@(_ => MoveToBottom(projectPerson.Rank ?? 0))"
                                               Icon="@projectPerson.DoubleDownIcon"></MudIconButton>
                            </MudTd>
                            <MudTd DataLabel="Rank">@projectPerson.Rank</MudTd>
                            <MudTd DataLabel="">
                                <MudImage Class="rounded-lg can-click"
                                          Elevation="5"
                                          Height="200"
                                          ObjectFit="@ObjectFit.Cover"
                                          Src="@(GetImageData(projectPerson.Person.PersonImageFileName))"
                                          Width="200" />
                            </MudTd>
                            <MudTd DataLabel="Person">@projectPerson.Person.DisplayName</MudTd>
                            <MudTd DataLabel="Item">@projectPerson.ItemTypeName</MudTd>
                            <MudTd DataLabel="Priority">@projectPerson.PriorityTypeName</MudTd>
                            <MudTd DataLabel="Upgrade">@(projectPerson.Upgrade ? "Yes" : "No")</MudTd>
                            <MudTd DataLabel="Deceased">@(projectPerson.Deceased ? "Yes" : "No")</MudTd>
                            <MudTd DataLabel="Status">@projectPerson.ProjectStatusTypeName</MudTd>
                            <MudTd DataLabel="">
                                <MudTooltip Text="Delete">
                                    <MudFab Color="MudBlazor.Color.Secondary"
                                            Icon="@Icons.Material.Outlined.DeleteOutline"
                                            OnClick="@(_ => Remove(projectPerson.Id, projectPerson.Person.Id, projectPerson.ItemTypeId))" />
                                </MudTooltip>
                            </MudTd>
                        </RowTemplate>
                        <RowEditingTemplate>
                            <MudTd>
                                <MudIconButton @onclick="@(_ => MoveToTop(context.Rank ?? 0))"
                                               hidden="@(!context.DisplayDoubleUpIcon)"
                                               Icon="@context.DoubleUpIcon"></MudIconButton>
                                <MudIconButton @onclick="@(_ => MoveUp(context.Rank ?? 0))"
                                               hidden="@(!context.DisplayUpIcon)"
                                               Icon="@context.UpIcon"></MudIconButton>
                                <MudIconButton @onclick="@(_ => MoveDown(context.Rank ?? 0))"
                                               Icon="@context.DownIcon"></MudIconButton>
                                <MudIconButton @onclick="@(_ => MoveToBottom(context.Rank ?? 0))"
                                               Icon="@context.DoubleDownIcon"></MudIconButton>
                            </MudTd>
                            <MudTd DataLabel="Rank">
                                <MudNumericField @bind-Value="@context.Rank" Required Min="1" />
                            </MudTd>
                            <MudTd DataLabel="">
                                <MudImage Class="rounded-lg can-click"
                                          Elevation="5"
                                          Height="200"
                                          ObjectFit="@ObjectFit.Cover"
                                          Src="@(GetImageData(context.Person.PersonImageFileName))"
                                          Width="200" />
                            </MudTd>
                            <MudTd DataLabel="Person">@context.Person.DisplayName</MudTd>
                            <MudTd DataLabel="Item">@context.ItemTypeName</MudTd>
                            <MudTd DataLabel="Priority">
                                <PriorityTypeDropDown SelectedValue="@context.PriorityTypeId"
                                                      SelectionChanged="(p) => context.PriorityTypeId = p" />
                            </MudTd>
                            <MudTd DataLabel="Upgrade">
                                <BooleanCheckBox Checked="@context.Upgrade"
                                                 CheckedChanged="(p) => context.Upgrade = p"
                                                 Label="Is Upgrade" />
                            </MudTd>
                            <MudTd DataLabel="Deceased">@(context.Deceased ? "Yes" : "No")</MudTd>
                            <MudTd DataLabel="Status">
                                <ProjectStatusTypeDropDown SelectedValue="@context.ProjectStatusTypeId"
                                                           SelectionChanged="(p) => context.ProjectStatusTypeId = p" />
                            </MudTd>
                            <MudTd DataLabel="">
                                <MudTooltip Text="Delete">
                                    <MudFab Color="MudBlazor.Color.Secondary"
                                            Icon="@Icons.Material.Outlined.DeleteOutline"
                                            OnClick="@(_ => Remove(context.Id, context.Person.Id, context.ItemTypeId))" />
                                </MudTooltip>
                            </MudTd>
                        </RowEditingTemplate>
                    </MudTable>
            </Content>
        </DivRowCol12>
        <br />
    </Content>
</EditPage>
