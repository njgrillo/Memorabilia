@inherits ReroutePage

<PageView AddRoute="@NavigationPath.SignatureIdentificationAdd"
          AddTitle="@($"{Constant.EditModeType.Add.Name} Signature Identification")"
          DisplayAddButton="_canInteract"
          DisplayPageHeader="false"
          DisplayPageFooter="false"
          NavigationPath="@NavigationPath.Home"
          PageTitle="Signature Identifications">
    <DivPad2>
        <LeftRightSection Style="@Style.MarginBottomPad1">
            <Right>
                <CustomButton OnClick="Random"
                              Text="Identify Random Signature"
                              Visible="DisplayIdentifyRandomButton" />
            </Right>
        </LeftRightSection>
        <MudTable @ref="_table" 
                  Bordered="false"
                  Dense="false"
                  Hover="true"
                  Items="Model.SignatureIdentifications"
                  ServerData="@(new Func<TableState, Task<TableData<SignatureIdentificationModel>>>(OnRead))"
                  Striped="true">
            <ToolBarContent>
                <ToolbarTitle Text="Signature Identifications" />
            </ToolBarContent>
            <HeaderContent>
                <MudTh></MudTh>
                <MudTh></MudTh>
                <MudTh>Consensus Person</MudTh>
                <MudTh>Note</MudTh>
                <MudTh>Created By</MudTh>
                <MudTh>Created On</MudTh>
                <MudTh></MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd>
                    <ToggleGridButton Toggled="@(_ => ToggleChildContent(context.Id))"
                                      Visible="context.People.Any()" />
                </MudTd>
                <MudTh>
                    <GridImage AllowNavigation="true" 
                               ImageFileName="@context.Images.First().FileName"
                               ImageLoaded="StateHasChanged"
                               OnClick="@(_ => OnImageClick(context))"
                               UserId="context.CreatedUser.Id" />
                </MudTh>
                <MudTd DataLabel="ConsensusPerson">
                    @(context.ConsensusPerson?.ProfileName ?? "No results yet")
                </MudTd>
                <MudTd DataLabel="Note">@context.Note</MudTd>
                <MudTd DataLabel="CreatedBy">@context.CreatedUser.Username</MudTd>
                <MudTd DataLabel="CreatedOn">@(context.CreatedDate.ToString("MM-dd-yyyy hh:mm:ss tt"))</MudTd>
                <TableDataRightAligned>
                    <Fab Color="MudBlazor.Color.Primary"
                         OnClick="@(_ => View(context.Id))"
                         Size="MudBlazor.Size.Large"
                         StartIcon="@Icons.Material.Outlined.PersonSearch"
                         TooltipText="Identify"
                         Visible="DisplayIdentifyGridButton" />
                </TableDataRightAligned>
            </RowTemplate>
            <ChildRowContent>
                 <HiddenControl Visible="@context.DisplayDetails">
                    <tr />
                    <SummarySection>
                        <TableDataCentered>
                            Summary: Total Opinions - <strong> @context.People.Length </strong>
                        </TableDataCentered>
                    </SummarySection>
                    <tr />
                    <TableRowPadded>
                        <TableDataSpan>
                            <MudTable Bordered="false"
                                      Dense="false"
                                      Hover="true"
                                      Items="context.People"
                                      Striped="true">
                                <ToolBarContent>
                                    <ToolbarTitle Text="Opinions" />
                                    <MudSpacer />
                                </ToolBarContent>
                                <HeaderContent>
                                    <MudTh></MudTh>
                                    <MudTh>Person</MudTh>
                                    <MudTh>Note</MudTh>
                                    <MudTh>Created By</MudTh>
                                    <MudTh>Created On</MudTh>
                                </HeaderContent>
                                <RowTemplate Context="person">
                                    <MudTd>
                                        <PersonGridImage ImageData="@(ImageService.GetPersonImageData(person.Person.ImageFileName))"
                                                         ImageLoaded="StateHasChanged"
                                                         PersonId="person.Person.Id"/>
                                    </MudTd>
                                    <MudTd DataLabel="Person">@person.Person.ProfileName</MudTd>
                                    <MudTd DataLabel="Note">@person.Note</MudTd>
                                    <MudTd DataLabel="CreatedBy">@person.CreatedUser.Username</MudTd>
                                    <MudTd DataLabel="CreatedOn">@(person.CreateDate.ToString("MM-dd-yyyy hh:mm:ss tt"))</MudTd>
                                </RowTemplate>
                                <PagerContent>
                                    <MudTablePager />
                                </PagerContent>
                            </MudTable>
                        </TableDataSpan>
                    </TableRowPadded>
                 </HiddenControl>
            </ChildRowContent>
            <PagerContent>
                <MudTablePager />
            </PagerContent>
        </MudTable>
    </DivPad2>
</PageView>

