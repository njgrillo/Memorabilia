@using Memorabilia.Application.Features.Admin.Person
@using Memorabilia.Web.Controls.Franchise
@using Memorabilia.Web.Controls.SportLeagueLevel

<div class="row">
    <div class="col-lg-12">
        <div class="form-group">
            <label for="sportLeague">Sport League</label>
            <_SportLeagueLevelDropDown @bind-Value="@_viewModel.SportLeagueLevelId"
                                       @bind-Value:event="ValueChanged" /> 
        </div> 
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <div class="form-group">
            <label for="franchise">Franchise</label>
            <_FranchiseDropDown @bind-Value="@_viewModel.FranchiseId"
                                @bind-Value:event="ValueChanged" /> 
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-6">
        <div class="form-group">
            <label for="inductionYear">Induction Year</label>
            <InputNumber class="form-control" @bind-Value="_viewModel.InductionYear" />
        </div>
    </div> 
    <div class="col-lg-6">
        <div class="form-group">
            <label for="votePercentage">Vote Percentage</label>
            <InputNumber class="form-control" @bind-Value="_viewModel.VotePercentage" />
        </div>
    </div> 
</div> 
<div class="text-right">
    <button type="button" class="btn btn-secondary" @onclick="Add">Add</button>
</div>
<br />
<_Table Items="HallOfFames.Where(x => !x.IsDeleted).ToList()" 
        ItemsPerPage="5"   
        TItem="SavePersonHallOfFameViewModel">
    <HeaderTemplate>
        <th scope="col">Sport</th>
        <th scope="col">Franchise</th>
        <th scope="col">Induction Year</th>
        <th scope="col">Vote Percentage</th>
        <th scope="col"></th>
    </HeaderTemplate>
    <RowTemplate>
        <td>@context.SportName</td>
        <td>@context.FranchiseName</td>
        <td>@context.InductionYear</td>
        <td>@context.VotePercentage</td>
        <td>
            <_Tooltip Text="Delete">
                <img class="can-click" 
                     src="images/trash.png" 
                     height="25" 
                     width="25" 
                     @onclick="@(_ => Remove(context.SportLeagueLevelId))" />
            </_Tooltip>
        </td>
    </RowTemplate>
</_Table>

@code {
    [Parameter]
    public List<SavePersonHallOfFameViewModel> HallOfFames { get; set; } = new();

    private SavePersonHallOfFameViewModel _viewModel = new SavePersonHallOfFameViewModel();

    private void Add()
    {        
        HallOfFames.Add(_viewModel);

        _viewModel = new SavePersonHallOfFameViewModel();
    }

    private void Remove(int sportLeagueLevelId)
    {
        var hallOfFame = HallOfFames.SingleOrDefault(hallOfFame => hallOfFame.SportLeagueLevelId == sportLeagueLevelId);

        if (hallOfFame == null)
            return;

        hallOfFame.IsDeleted = true;                                                                             
    } 
}
