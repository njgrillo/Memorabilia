@page "/BaseballTypes"

@using Memorabilia.Application.Features.Admin
@using Memorabilia.Application.Features.Admin.BaseballType

@inject CommandRouter _commandRouter
@inject ProtectedLocalStorage _localStorage
@inject NavigationManager _navigation
@inject QueryRouter _queryRouter

@if (!_pageLoaded)
{
    <_PageLoader />
}
else
{
    <_DomainTable DomainEntities="@_viewModel.DomainEntities"
                  DomainItemName="@_viewModel.ItemTitle"
                  DomainItemTitle="@_viewModel.PageTitle"
                  OnDelete="Delete"
                  RoutePrefix="@_viewModel.RoutePrefix" />
}

@code {
    private bool _pageLoaded;
    private BaseballTypesViewModel _viewModel;

    protected async Task Delete(SaveDomainViewModel viewModel)
    {
        var command = new SaveBaseballType.Command(viewModel);

        await _commandRouter.Send(command).ConfigureAwait(false);
    }

    protected override async Task OnInitializedAsync()
    {
        var userId = await _localStorage.GetAsync<int>("UserId");

        if (userId.Value == 0)
            _navigation.NavigateTo("Login");

        var query = new GetBaseballTypes.Query();

        _viewModel = await _queryRouter.Send(query).ConfigureAwait(false);
        _pageLoaded = true;
    }
}
